<!doctype html>
<html lang="ja"><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Camera + IMU Minimal</title>
<style>
  body{font-family:system-ui, "Noto Sans JP", sans-serif; margin:20px;}
  video{width:100%;max-width:520px;background:#000;border-radius:8px}
  .row{margin:8px 0}
  code{display:inline-block;min-width:120px}
</style>
<body>
<h2>æœ€å°ãƒ‡ãƒ¢ï¼ˆã‚«ãƒ¡ãƒ©ï¼†IMUï¼‰</h2>
<div class="row"><button id="cam">ğŸ“· ã‚«ãƒ¡ãƒ©é–‹å§‹</button> <button id="imu">ğŸ“¡ ã‚»ãƒ³ã‚µãƒ¼è¨±å¯</button></div>
<video id="v" playsinline muted></video>
<div class="row"><b>acc:</b> <code id="acc">x=0 y=0 z=0</code></div>
<div class="row"><b>ori:</b> <code id="ori">yaw=0 pitch=0 roll=0</code></div>
<script>
const v = document.getElementById('v');
document.getElementById('cam').onclick = async () => {
  try {
    const s = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: {ideal:'environment'} }, audio:false
    });
    v.srcObject = s; await v.play();
  } catch(e){ alert('ã‚«ãƒ¡ãƒ©NG: '+e.message); }
};

document.getElementById('imu').onclick = async () => {
  try {
    if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
      const st = await DeviceMotionEvent.requestPermission(); if (st!=='granted') throw new Error('DeviceMotionæ‹’å¦');
    }
    if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
      await DeviceOrientationEvent.requestPermission().catch(()=>{});
    }
  } catch(e){ alert('ã‚»ãƒ³ã‚µãƒ¼è¨±å¯ãŒå¿…è¦: '+e.message); }

  window.addEventListener('devicemotion', e=>{
    const a = e.accelerationIncludingGravity || e.acceleration || {x:0,y:0,z:0};
    document.getElementById('acc').textContent =
      `x=${(a.x||0).toFixed(2)} y=${(a.y||0).toFixed(2)} z=${(a.z||0).toFixed(2)}`;
  }, {passive:true});

  window.addEventListener('deviceorientation', e=>{
    document.getElementById('ori').textContent =
      `yaw=${(e.alpha||0).toFixed(1)} pitch=${(e.beta||0).toFixed(1)} roll=${(e.gamma||0).toFixed(1)}`;
  }, {passive:true});
};
</script>
</body>
