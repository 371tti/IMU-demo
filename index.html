<!doctype html>
<html lang="ja"><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>IMU Minimal on GitHub Pages</title>
<style>
  body{font-family:system-ui,"Noto Sans JP",sans-serif;margin:20px;line-height:1.6}
  .row{margin:10px 0}
  code{display:inline-block;min-width:240px;background:#f5f5f7;padding:4px 8px;border-radius:6px}
  .ok{color:#0a7} .warn{color:#c80} .bad{color:#d33}
  button{padding:10px 14px;border-radius:10px;border:1px solid #ccc;background:#fff}
</style>
<body>
<h2>ã‚»ãƒ³ã‚µãƒ¼ç¢ºèªãƒ‡ãƒ¢ï¼ˆGitHub Pages ç”¨ï¼‰</h2>

<div class="row">çŠ¶æ…‹: <span id="state">init...</span></div>
<div class="row"><button id="perm">ğŸ“¡ ã‚»ãƒ³ã‚µãƒ¼è¨±å¯</button></div>

<div class="row"><b>DeviceMotion:</b> <code id="dm">å¾…æ©Ÿä¸­</code></div>
<div class="row"><b>Orientation:</b> <code id="do">å¾…æ©Ÿä¸­</code></div>

<div class="row"><b>Generic Sensor API (Accel):</b> <code id="ga">æœªä½¿ç”¨</code></div>
<div class="row"><b>Generic Sensor API (Gyro):</b> <code id="gg">æœªä½¿ç”¨</code></div>

<script>
const $ = (id)=>document.getElementById(id);
const secure = window.isSecureContext;
const hasDM = 'DeviceMotionEvent' in window;
const hasDO = 'DeviceOrientationEvent' in window;
const hasGS = 'Accelerometer' in window || 'Gyroscope' in window;

function setState(msg, cls=''){ const el=$('state'); el.textContent=msg; el.className=cls; }
function fmt(n){ return (n==null?0:n).toFixed(3); }

setState(`secure=${secure} / DM=${hasDM} / DO=${hasDO} / GS=${hasGS}`, secure?'ok':'bad');

let dmCount=0, doCount=0, gaCount=0, ggCount=0;

function attachLegacy(){
  // DeviceMotion / DeviceOrientation
  window.addEventListener('devicemotion', e=>{
    dmCount++;
    const a = e.accelerationIncludingGravity || e.acceleration || {};
    $('dm').textContent = `#${dmCount} ax=${fmt(a.x)} ay=${fmt(a.y)} az=${fmt(a.z)}`;
  }, {passive:true});
  window.addEventListener('deviceorientation', e=>{
    doCount++;
    $('do').textContent = `#${doCount} yaw=${fmt(e.alpha)} pitch=${fmt(e.beta)} roll=${fmt(e.gamma)}`;
  }, {passive:true});
}

async function attachGeneric(){
  try{
    if('Accelerometer' in window){
      const acc = new Accelerometer({frequency:30}); // 30Hzç¨‹åº¦
      acc.addEventListener('reading', ()=>{
        gaCount++;
        $('ga').textContent = `#${gaCount} ax=${fmt(acc.x)} ay=${fmt(acc.y)} az=${fmt(acc.z)}`;
      });
      acc.start();
    } else {
      $('ga').textContent = 'æœªå¯¾å¿œ';
    }
    if('Gyroscope' in window){
      const gyro = new Gyroscope({frequency:30});
      gyro.addEventListener('reading', ()=>{
        ggCount++;
        $('gg').textContent = `#${ggCount} gx=${fmt(gyro.x)} gy=${fmt(gyro.y)} gz=${fmt(gyro.z)}`;
      });
      gyro.start();
    } else {
      $('gg').textContent = 'æœªå¯¾å¿œ';
    }
  }catch(e){
    $('ga').textContent = 'ã‚¨ãƒ©ãƒ¼: '+e.message;
    $('gg').textContent = 'ã‚¨ãƒ©ãƒ¼: '+e.message;
  }
}

$('perm').onclick = async ()=>{
  // iOS ã® requestPermissionï¼ˆã‚¿ãƒƒãƒ—èµ·ç‚¹ãŒå¿…é ˆï¼‰
  try{
    if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
      const st = await DeviceMotionEvent.requestPermission();
      if(st !== 'granted') throw new Error('DeviceMotion æ‹’å¦');
    }
    if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
      await DeviceOrientationEvent.requestPermission().catch(()=>{});
    }
  }catch(e){
    setState('iOS æ¨©é™ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ: '+e.message, 'bad');
  }

  // æ—§API (Safari/Chromeç«¯æœ«ä¾å­˜)
  if(hasDM || hasDO) attachLegacy();

  // Generic Sensor APIï¼ˆAndroid Chrome ã§å‹•ãã“ã¨ãŒå¤šã„ / iOS Safariã¯æœªå¯¾å¿œï¼‰
  if(hasGS) attachGeneric();

  setState('ãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²å®Œäº†ï¼šç«¯æœ«ã‚’å°‘ã—å‹•ã‹ã—ã¦ã¿ã¦ãã ã•ã„', 'ok');
};

// åˆæœŸãƒã‚§ãƒƒã‚¯
if(!secure){
  setState('éHTTPSãªã®ã§ã‚»ãƒ³ã‚µãƒ¼ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã™ï¼ˆGitHub Pagesã¯HTTPSãªã®ã§ã€ã“ã®è¡¨ç¤ºãŒå‡ºã¦ãŸã‚‰åˆ¥ã®çµŒè·¯ã§é–‹ã„ã¦ã„ã‚‹å¯èƒ½æ€§ï¼‰', 'bad');
}
</script>
</body>
